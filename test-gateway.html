<!DOCTYPE html>
<html>
<head>
    <title>测试网关连接</title>
</head>
<body>
    <h1>测试小智网关连接</h1>
    <button onclick="testConnection()">测试连接</button>
    <div id="result"></div>

    <script>
        async function testConnection() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '正在测试...';

            try {
                console.log('开始测试网关连接...');
                
                // 测试健康检查
                const healthResponse = await fetch('http://localhost:3000/healthz');
                console.log('健康检查状态:', healthResponse.status);
                const healthData = await healthResponse.json();
                console.log('健康检查数据:', healthData);

                // 测试会话创建
                const sessionResponse = await fetch('http://localhost:3000/session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: 'test-user-web' })
                });
                
                console.log('会话创建状态:', sessionResponse.status);
                const sessionData = await sessionResponse.json();
                console.log('会话数据:', sessionData);

                resultDiv.innerHTML = `
                    <p>✅ 连接成功!</p>
                    <p>健康状态: ${healthData.status}</p>
                    <p>会话ID: ${sessionData.sessionId}</p>
                    <p>WebSocket URL: ${sessionData.wsUrl}</p>
                `;
                
            } catch (error) {
                console.error('连接失败:', error);
                resultDiv.innerHTML = `
                    <p>❌ 连接失败: ${error.message}</p>
                    <p>请检查:</p>
                    <ul>
                        <li>网关是否运行在 http://localhost:3000</li>
                        <li>浏览器控制台是否有CORS错误</li>
                        <li>网络连接是否正常</li>
                    </ul>
                `;
            }
        }
    </script>
</body>
</html>